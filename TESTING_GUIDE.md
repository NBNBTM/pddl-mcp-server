# PDDL MCP Server 测试执行指南

## 前提条件确认

### 1. 环境检查
确保以下环境已正确配置：
- ✅ Python 3.8+ 已安装
- ✅ 依赖包已安装 (`pip install -r requirements.txt`)
- ✅ `.env` 文件已配置
- ✅ Trae IDE 已导入 pddl-mcp

### 2. 服务器状态验证
在 Trae IDE 中，MCP 服务器应显示为已连接状态。

## 测试方法

### 方法1：在 Trae IDE 中直接测试

#### 基础功能测试

**1. 系统配置检查**
```
请检查PDDL规划系统的配置状态
```

**2. 简单规划任务**
```
请帮我规划一个机器人任务：
- 机器人：r1
- 起始位置：room1
- 目标位置：room3
- 任务类型：delivery

请生成完整的PDDL规划方案。
```

**3. 自然语言规划**
```
机器人需要从仓库移动到办公室，请帮我生成移动计划。
```

**4. 多机器人协调**
```
我有一个多机器人协调任务：
1. 机器人r1在room1，需要到room5
2. 机器人r2在room3，需要到room2
请为每个机器人生成独立的规划方案，并分析可能的路径冲突。
```

**5. 批量任务处理**
```
请帮我批量处理以下机器人任务：
1. r1: room1 → room3 (delivery)
2. r2: room2 → room4 (patrol)
3. r3: room5 → room1 (maintenance)

生成批量执行报告。
```

### 方法2：命令行测试

#### 1. 启动服务器
```bash
cd d:\PDDL\pddl-mcp
python server.py
```

#### 2. 运行测试套件
```bash
python test_server.py
```

#### 3. 批量任务测试
```bash
python core/batch_runner.py
```

## 预期结果验证

### 1. 系统配置检查结果
应返回包含以下信息的JSON响应：
- ✅ 配置文件路径
- ✅ Fast Downward 路径
- ✅ 环境变量状态
- ✅ 输出目录配置

### 2. 规划任务结果
应生成以下文件：
- ✅ PDDL问题文件 (`output/pddl/`)
- ✅ 规划方案 (`output/plan/`)
- ✅ 执行说明 (`output/explanation/`)

### 3. 批量任务结果
应生成：
- ✅ 批量报告 (`output/report.json`)
- ✅ 详细分析 (`output/report.md`)
- ✅ 各任务的独立文件

## 常见测试场景

### 场景1：基础移动任务
```
测试目标：验证基本的机器人移动规划
输入：单机器人，简单路径
预期：生成1-3步的移动方案
```

### 场景2：复杂路径规划
```
测试目标：验证多步骤路径规划
输入：机器人需要经过多个房间
预期：生成最优路径方案
```

### 场景3：多机器人协调
```
测试目标：验证多机器人任务协调
输入：多个机器人，可能存在路径冲突
预期：生成冲突分析和解决方案
```

### 场景4：错误处理
```
测试目标：验证错误处理机制
输入：无效的任务参数
预期：返回清晰的错误信息
```

## 故障排除

### 问题1：服务器无法启动
**症状**：`python server.py` 报错
**解决方案**：
1. 检查依赖包：`pip install -r requirements.txt`
2. 检查Python版本：`python --version`
3. 检查 `.env` 文件配置

### 问题2：规划失败
**症状**：返回规划错误
**解决方案**：
1. 验证 Fast Downward 路径配置
2. 检查领域文件 `templates/domain.pddl`
3. 确认输出目录权限

### 问题3：MCP连接失败
**症状**：Trae IDE 中显示连接错误
**解决方案**：
1. 重启 Trae IDE
2. 检查 `.mcp.json` 配置
3. 确认服务器端口未被占用

### 问题4：文件生成失败
**症状**：没有生成预期的输出文件
**解决方案**：
1. 检查 `output/` 目录权限
2. 确认磁盘空间充足
3. 验证文件路径配置

## 性能测试

### 1. 响应时间测试
```
测试简单任务的响应时间：
- 目标：< 2秒
- 方法：多次执行基础规划任务
```

### 2. 并发测试
```
测试多个任务同时执行：
- 目标：无冲突，正确处理
- 方法：同时提交多个规划请求
```

### 3. 大规模任务测试
```
测试复杂的多机器人任务：
- 目标：能够处理10+机器人的协调
- 方法：创建大规模测试用例
```

## 测试检查清单

### 基础功能 ✅
- [ ] 系统配置检查
- [ ] 简单规划任务
- [ ] 自然语言处理
- [ ] 文件生成

### 高级功能 ✅
- [ ] 多机器人协调
- [ ] 批量任务处理
- [ ] 路径冲突分析
- [ ] 错误处理

### 性能测试 ✅
- [ ] 响应时间
- [ ] 并发处理
- [ ] 大规模任务
- [ ] 内存使用

### 集成测试 ✅
- [ ] Trae IDE 集成
- [ ] MCP 协议兼容性
- [ ] 文件系统操作
- [ ] 配置管理

## 测试报告模板

```
测试日期：[日期]
测试环境：[操作系统、Python版本]
测试范围：[测试的功能模块]

测试结果：
✅ 通过的测试项
❌ 失败的测试项
⚠️  需要注意的问题

性能指标：
- 平均响应时间：[时间]
- 成功率：[百分比]
- 资源使用：[内存、CPU]

建议：
[改进建议]
```

## 下一步

完成基础测试后，可以：
1. **扩展测试用例**：添加更复杂的规划场景
2. **性能优化**：根据测试结果优化性能
3. **功能扩展**：添加新的规划算法或功能
4. **文档完善**：更新使用文档和API参考

---

**注意**：测试过程中如遇到问题，请查看 `output/` 目录下的日志文件，或运行 `python test_server.py` 获取详细的诊断信息。